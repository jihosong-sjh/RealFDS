# Fraud Detector Application Configuration
# 실시간 금융 거래 탐지 시스템 설정 파일
#
# 환경 변수로 오버라이드 가능:
# - KAFKA_BOOTSTRAP_SERVERS
# - HIGH_VALUE_THRESHOLD
# - FLINK_CHECKPOINT_INTERVAL

# Kafka 설정
kafka {
  # Kafka 브로커 주소
  # 환경 변수: KAFKA_BOOTSTRAP_SERVERS
  bootstrap.servers = "kafka:9092"
  bootstrap.servers = ${?KAFKA_BOOTSTRAP_SERVERS}

  # 컨슈머 그룹 ID
  consumer.group.id = "fraud-detector-group"

  # 소비할 토픽 (입력)
  source.topic = "virtual-transactions"

  # 발행할 토픽 (출력)
  sink.topic = "transaction-alerts"

  # 오프셋 설정
  # earliest: 토픽의 처음부터 소비
  # latest: 최신 메시지부터 소비
  auto.offset.reset = "earliest"

  # 자동 커밋 비활성화 (Flink가 관리)
  enable.auto.commit = false
}

# 탐지 규칙 설정
rules {
  # 고액 거래 탐지 임계값 (KRW)
  # 환경 변수: HIGH_VALUE_THRESHOLD
  high.value.threshold = 1000000
  high.value.threshold = ${?HIGH_VALUE_THRESHOLD}

  # 해외 거래 탐지 (한국 외 국가)
  domestic.country.code = "KR"

  # 빈번한 거래 탐지 설정
  high.frequency {
    # 시간 윈도우 (밀리초)
    window.duration = 60000  # 1분

    # 임계값 (윈도우 내 거래 횟수)
    threshold = 5
  }
}

# Flink 설정
flink {
  # 체크포인트 간격 (밀리초)
  # 환경 변수: FLINK_CHECKPOINT_INTERVAL
  checkpoint.interval = 60000  # 60초
  checkpoint.interval = ${?FLINK_CHECKPOINT_INTERVAL}

  # 워터마크 지연 허용 시간 (초)
  watermark.max.out.of.orderness = 5

  # 재시작 전략
  restart.strategy {
    # 재시작 시도 횟수
    attempts = 3

    # 재시작 간격 (밀리초)
    delay = 10000  # 10초
  }
}

# 로깅 설정
logging {
  # 로그 레벨: TRACE, DEBUG, INFO, WARN, ERROR
  level = "INFO"
  level = ${?LOG_LEVEL}
}

# 애플리케이션 메타데이터
app {
  name = "fraud-detector"
  version = "1.0.0"
  description = "Real-time Fraud Detection Engine"
}
