# Feature Specification: Alert History (과거 알림 조회)

**Feature Branch**: `003-alert-history`
**Created**: 2025-11-11
**Status**: Draft
**Input**: User description: "for 003-alert-history 한국어로 알려줘"

---

**📝 문서화 언어 원칙 (Constitution VI)**:
- 모든 섹션은 **한국어**로 작성합니다
- 사용자 시나리오, 요구사항, 성공 기준 등 모든 내용은 한국어로 기술합니다
- 기술 용어는 영어 병기 가능 (예: "이벤트 시간(event-time)")
- 예시 코드/스키마는 영어 사용 가능하나 설명은 한국어로 작성합니다

---

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 기본 알림 이력 조회 (Priority: P1)

보안 담당자는 과거에 발생한 모든 알림을 조회하여 패턴을 분석하고 오탐(false positive)을 검토할 수 있어야 합니다. 시스템 재시작 후에도 모든 알림 데이터는 보존되어야 합니다.

**Why this priority**: 알림 데이터의 영속성은 이후 모든 분석 기능(통계, 패턴 분석)의 기반이 됩니다. 이 기능 없이는 시스템 재시작 시 모든 이력이 소실되어 실제 운영이 불가능합니다.

**Independent Test**:
- 100개의 알림을 생성하고 시스템을 재시작한 후 모든 알림이 조회 가능한지 확인
- 단독으로 테스트 가능하며 알림 영속화라는 명확한 가치를 제공

**Acceptance Scenarios**:

1. **Given** 시스템에 50개의 알림이 저장되어 있을 때, **When** 보안 담당자가 알림 이력 페이지를 열면, **Then** 최신 순으로 정렬된 알림 목록이 표시되어야 함
2. **Given** 시스템에 200개의 알림이 저장되어 있을 때, **When** 보안 담당자가 알림 이력을 조회하면, **Then** 페이지당 50개씩 페이지네이션되어 표시되어야 함
3. **Given** 알림이 데이터베이스에 저장된 상태에서, **When** 시스템을 재시작하면, **Then** 모든 알림 데이터가 유지되고 정상적으로 조회 가능해야 함

---

### User Story 2 - 날짜 범위 검색 (Priority: P2)

보안 담당자는 특정 기간(예: 지난주, 어제, 특정 날짜 범위) 동안 발생한 알림만 조회하여 시간대별 패턴을 분석할 수 있어야 합니다.

**Why this priority**: 날짜 기반 검색은 가장 일반적인 조회 패턴입니다. 월말 결산, 주간 리포트 작성 등 실무에서 필수적인 기능입니다.

**Independent Test**:
- 1주일 전부터 오늘까지 매일 10개씩 알림 생성
- 특정 날짜 범위(예: 3일 전 ~ 1일 전)로 검색하여 해당 기간의 알림만 조회되는지 확인
- Story 1과 독립적으로 테스트 가능

**Acceptance Scenarios**:

1. **Given** 2025-11-01부터 2025-11-10까지 매일 알림이 발생했을 때, **When** 보안 담당자가 2025-11-05 ~ 2025-11-07 범위로 검색하면, **Then** 해당 3일간의 알림만 조회되어야 함
2. **Given** 날짜 범위 검색 조건을 입력할 때, **When** 시작 날짜가 종료 날짜보다 늦은 경우, **Then** 유효성 검사 오류 메시지가 표시되어야 함
3. **Given** 특정 날짜 범위로 검색했을 때, **When** 검색 결과가 1000개 이상이면, **Then** 페이지네이션으로 분할 표시되어야 함

---

### User Story 3 - 다중 조건 필터링 (Priority: P3)

보안 담당자는 규칙명, 사용자 ID, 알림 상태(미확인/확인중/완료) 등 여러 조건을 조합하여 원하는 알림만 필터링할 수 있어야 합니다.

**Why this priority**: 다중 필터링은 편의성을 높이지만 핵심 기능은 아닙니다. P1, P2가 구현되면 수동으로 목록을 확인할 수 있습니다.

**Independent Test**:
- 다양한 규칙(HIGH_AMOUNT, RAPID_TRANSACTION), 상태(UNREAD, COMPLETED), 사용자로 알림 생성
- 규칙명="HIGH_AMOUNT" AND 상태="UNREAD" 조건으로 검색하여 정확히 매칭되는 알림만 조회되는지 확인
- Story 1, 2와 독립적으로 테스트 가능

**Acceptance Scenarios**:

1. **Given** 다양한 규칙에 의해 발생한 알림들이 있을 때, **When** "HIGH_AMOUNT" 규칙으로 필터링하면, **Then** 해당 규칙으로 발생한 알림만 표시되어야 함
2. **Given** 여러 사용자의 알림이 있을 때, **When** 특정 사용자 ID로 필터링하면, **Then** 해당 사용자와 관련된 알림만 표시되어야 함
3. **Given** 상태가 다양한 알림들이 있을 때, **When** 상태="COMPLETED"로 필터링하면, **Then** 처리 완료된 알림만 표시되어야 함
4. **Given** 날짜 범위와 규칙명을 동시에 선택했을 때, **When** 검색을 실행하면, **Then** 두 조건을 모두 만족하는 알림만 표시되어야 함

---

### Edge Cases

- **데이터베이스가 비어있을 때**: 알림 이력 페이지에 "조회된 알림이 없습니다" 메시지가 표시되어야 함
- **검색 결과가 0건일 때**: "검색 조건에 맞는 알림이 없습니다" 메시지가 표시되어야 함
- **10,000개 이상의 대량 알림 조회**: 페이지네이션과 인덱스를 통해 성능 저하 없이 조회 가능해야 함
- **동시 접속 사용자**: 여러 사용자가 동시에 다른 검색 조건으로 조회해도 서로 영향을 주지 않아야 함
- **잘못된 날짜 형식 입력**: 사용자가 날짜 선택 UI를 사용하므로 형식 오류는 최소화되나, API 레벨에서는 ISO 8601 형식 검증 필요
- **PostgreSQL 연결 실패**: 데이터베이스 연결 오류 시 사용자에게 "알림 이력을 불러올 수 없습니다. 잠시 후 다시 시도해주세요" 메시지 표시

---

## Requirements *(mandatory)*

### Functional Requirements

**작성 가이드라인**:
- 모든 요구사항은 **한국어**로 작성합니다 (Constitution VI)
- 각 요구사항은 측정 가능하고 검증 가능해야 합니다
- Constitution 위반 가능성이 있는 요구사항은 명시적으로 표시합니다

**Constitution 준수 검증** (각 FR 작성 시 확인):
- [x] 학습 우선: 요구사항이 실시간 스트리밍 개념 학습에 기여하는가? - PostgreSQL 영속화 및 쿼리 최적화 학습
- [x] 단순함: 불필요한 복잡성을 추가하지 않는가? - 표준 RDBMS 패턴 사용
- [x] 실시간 우선: 실시간 처리와 낮은 지연 시간을 우선하는가? - 조회 성능 <500ms 보장
- [x] 서비스 경계: 3개 서비스 (TGS, RDE, RAD) 경계를 존중하는가? - alert-service 내부 확장
- [x] 품질 표준: 테스트 가능하고 로깅 가능한가? - 단위/통합 테스트 포함

---

#### 데이터 영속화

- **FR-001**: 시스템은 모든 알림을 PostgreSQL 데이터베이스에 영구 저장해야 합니다
- **FR-002**: 시스템은 알림 저장 시 고유 식별자(alertId), 타임스탬프, 규칙명, 거래 정보, 상태, 심각도를 포함해야 합니다
- **FR-003**: 시스템은 알림 저장 실패 시 로그를 기록하고 재시도 로직을 수행해야 합니다
- **FR-004**: 시스템 재시작 후에도 모든 저장된 알림 데이터는 유실 없이 유지되어야 합니다

#### 검색 기능

- **FR-005**: 시스템은 날짜 범위(startDate, endDate)로 알림을 검색할 수 있어야 합니다
- **FR-006**: 시스템은 규칙명(ruleName)으로 알림을 필터링할 수 있어야 합니다
- **FR-007**: 시스템은 사용자 ID(userId)로 알림을 필터링할 수 있어야 합니다
- **FR-008**: 시스템은 알림 상태(status: UNREAD, IN_PROGRESS, COMPLETED)로 알림을 필터링할 수 있어야 합니다
- **FR-009**: 시스템은 여러 검색 조건을 동시에 조합(AND 조건)하여 검색할 수 있어야 합니다

#### 성능 및 페이지네이션

- **FR-010**: 시스템은 알림 조회 시 한 페이지당 50개씩 표시해야 합니다
- **FR-011**: 시스템은 페이지 번호(page)와 페이지 크기(size)를 파라미터로 받아 페이지네이션을 지원해야 합니다
- **FR-012**: 시스템은 검색 결과의 전체 개수(totalElements)와 전체 페이지 수(totalPages)를 함께 반환해야 합니다
- **FR-013**: 시스템은 10,000개의 알림 중 검색 시 500ms 이내에 응답해야 합니다
- **FR-014**: 시스템은 alert_timestamp, rule_name, user_id, status 필드에 데이터베이스 인덱스를 생성하여 검색 성능을 최적화해야 합니다

#### UI 요구사항

- **FR-015**: 웹 대시보드는 알림 이력 조회 페이지를 제공해야 합니다
- **FR-016**: 알림 이력 페이지는 날짜 범위 선택 UI(DatePicker)를 제공해야 합니다
- **FR-017**: 알림 이력 페이지는 규칙명, 사용자 ID, 상태 필터링 드롭다운을 제공해야 합니다
- **FR-018**: 알림 목록은 최신 알림이 상단에 표시되도록 내림차순으로 정렬되어야 합니다
- **FR-019**: 페이지네이션 컨트롤(이전/다음 버튼, 페이지 번호)이 표시되어야 합니다
- **FR-020**: 검색 결과가 없을 때 "검색 조건에 맞는 알림이 없습니다" 메시지를 표시해야 합니다

#### 데이터 마이그레이션

- **FR-021**: 시스템은 Flyway를 사용하여 데이터베이스 스키마를 버전 관리해야 합니다
- **FR-022**: 기존 인메모리에 있던 알림 데이터는 PostgreSQL 도입 후에도 호환되어야 합니다 (스키마 일관성)

---

### Key Entities *(include if feature involves data)*

- **Alert (알림)**:
  - 탐지된 사기 의심 거래에 대한 알림 정보
  - 주요 속성: alertId(고유 식별자), schemaVersion, transactionId, userId, amount, ruleName, reason, severity, alertTimestamp, status, assignedTo, actionNote, processedAt, createdAt
  - 관계: 하나의 Transaction에 대해 여러 Alert가 발생할 수 있음 (1:N)

- **AlertSearchCriteria (검색 조건)**:
  - 알림 검색 시 사용되는 필터 조건
  - 주요 속성: startDate, endDate, ruleName, userId, status, page, size
  - 모든 필터는 선택적(optional)이며 조합 가능

- **PagedAlertResult (페이지네이션 결과)**:
  - 검색 결과와 페이지네이션 메타데이터를 포함
  - 주요 속성: content(Alert 배열), totalElements, totalPages, currentPage, pageSize
  - 프론트엔드가 페이지 컨트롤을 렌더링하는 데 필요한 정보 제공

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 시스템 재시작 후 모든 저장된 알림(100% 데이터)이 유실 없이 조회 가능해야 합니다
- **SC-002**: 10,000개의 알림이 저장된 상태에서 검색 응답 시간이 500ms 이내여야 합니다
- **SC-003**: 페이지네이션을 통해 1,000페이지(50,000개 알림) 규모에서도 성능 저하 없이 조회 가능해야 합니다
- **SC-004**: 사용자가 날짜 범위 + 규칙명 + 상태를 조합한 복합 검색을 3클릭 이내에 완료할 수 있어야 합니다
- **SC-005**: 검색 결과가 표시되는 데 걸리는 시간이 1초 이내여야 합니다 (네트워크 지연 포함)
- **SC-006**: 데이터베이스 마이그레이션이 자동으로 실행되어 수동 스키마 설정 없이 시스템 시작 시 즉시 사용 가능해야 합니다
- **SC-007**: 동시에 10명의 사용자가 서로 다른 검색 조건으로 조회해도 상호 간섭 없이 정확한 결과를 받아야 합니다

---

## Assumptions *(optional)*

- PostgreSQL 15 이상이 사용 가능하다고 가정합니다
- Docker Compose 환경에서 PostgreSQL 컨테이너를 실행한다고 가정합니다
- Spring Data R2DBC를 사용하여 비동기 데이터베이스 액세스를 구현한다고 가정합니다
- 알림 데이터는 무기한 보관하며, 별도의 아카이빙/삭제 정책은 현재 범위에서 제외합니다
- 검색 조건의 기본값은 "최근 7일"이며, 사용자가 날짜 범위를 지정하지 않으면 최근 7일 내 알림을 조회합니다
- 페이지당 기본 크기는 50개이며, 사용자가 변경할 수 없습니다 (향후 확장 가능)

---

## Constraints *(optional)*

- **기술적 제약**:
  - Spring WebFlux의 비동기 특성상 R2DBC를 사용해야 하며, JDBC는 사용할 수 없습니다
  - Flyway 마이그레이션은 동기 방식으로 실행되므로 애플리케이션 시작 시 약간의 지연이 발생할 수 있습니다
  - PostgreSQL 외 다른 데이터베이스(MySQL, MongoDB 등)는 현재 지원하지 않습니다

- **범위 제약**:
  - 전체 텍스트 검색(Full-text search)은 현재 범위에서 제외합니다
  - 고급 필터링(금액 범위, 정규표현식 매칭 등)은 현재 범위에서 제외합니다
  - CSV 내보내기 기능은 별도 feature(005-alert-analytics)에서 다룹니다
  - 알림 데이터 삭제/아카이빙 기능은 현재 범위에서 제외합니다

- **성능 제약**:
  - 최대 100,000개의 알림까지 테스트하며, 그 이상의 규모는 고려하지 않습니다
  - 동시 사용자는 최대 50명까지 지원합니다 (MVP 범위)

---

## Dependencies *(optional)*

- **선행 Feature**:
  - 002-alert-management (Alert 모델에 status, severity 필드 추가)
  - 002-alert-management가 완료되지 않은 경우, status 필드는 기본값(UNREAD)으로 처리

- **외부 의존성**:
  - PostgreSQL 15+ (Docker Compose로 실행)
  - Spring Data R2DBC
  - Flyway (데이터베이스 마이그레이션)

- **후속 Feature**:
  - 005-alert-analytics (알림 통계): 이 기능이 제공하는 영속 데이터를 기반으로 통계를 생성
  - 004-dashboard-realtime (실시간 대시보드): 과거 데이터와 실시간 데이터를 통합 표시

---

## Out of Scope *(optional)*

- 알림 데이터의 자동 삭제 또는 아카이빙
- 알림 템플릿 커스터마이징
- 이메일/SMS 알림 발송
- 알림에 대한 댓글/토론 기능
- 알림 대량 액션(일괄 상태 변경, 일괄 할당 등)
- 알림 북마크/즐겨찾기 기능
- 사용자별 개인화된 알림 이력 뷰

---

**문서 버전**: 1.0
**최종 업데이트**: 2025-11-11
